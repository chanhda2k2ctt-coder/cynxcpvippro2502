--[[
	MIDNIGHT CHASER FARM - EXTREME PERFORMANCE & SPEED EDITION
	Optimized by Antigravity
	UI Design: Modern Dark Glassmorphism 2026
]]

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local VirtualUser = game:GetService("VirtualUser")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- [UI LIBRARY EMBEDDED] --
local Library = {}

function Library:CreateWindow(Config)
	local Title = Config.text or "Cynx Hub"
	
	-- Cleanup Old UI
	for _, v in pairs(CoreGui:GetChildren()) do
		if v.Name:match("^CynxUI_") then v:Destroy() end
	end
	
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "CynxUI_" .. math.random(1, 10000)
	ScreenGui.Parent = CoreGui
	ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	ScreenGui.ResetOnSpawn = false

	-- OPEN / CLOSE BUTTON
	local ToggleBtnFrame = Instance.new("Frame")
	ToggleBtnFrame.Name = "ToggleUI"
	ToggleBtnFrame.Parent = ScreenGui
	ToggleBtnFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
	ToggleBtnFrame.Position = UDim2.new(0, 10, 0.5, -25)
	ToggleBtnFrame.Size = UDim2.new(0, 50, 0, 50)
	ToggleBtnFrame.BorderSizePixel = 0
	
	local ToggleCorner = Instance.new("UICorner")
	ToggleCorner.CornerRadius = UDim.new(0, 10)
	ToggleCorner.Parent = ToggleBtnFrame
	
	local ToggleBtn = Instance.new("ImageButton")
	ToggleBtn.Parent = ToggleBtnFrame
	ToggleBtn.BackgroundTransparency = 1
	ToggleBtn.Size = UDim2.new(1, 0, 1, 0)
	ToggleBtn.Image = "rbxassetid://3926305904" -- Settings Icon
	ToggleBtn.ImageColor3 = Color3.fromRGB(200, 200, 200)
	
	-- MAIN FRAME
	local MainFrame = Instance.new("Frame")
	MainFrame.Name = "MainFrame"
	MainFrame.Parent = ScreenGui
	MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	MainFrame.BorderSizePixel = 0
	MainFrame.Position = UDim2.new(0.5, -225, 0.5, -175)
	MainFrame.Size = UDim2.new(0, 450, 0, 350)
	MainFrame.ClipsDescendants = true
	MainFrame.Visible = true

	local UICorner = Instance.new("UICorner")
	UICorner.CornerRadius = UDim.new(0, 10)
	UICorner.Parent = MainFrame

	-- Glow Effect
	local Shadow = Instance.new("ImageLabel")
	Shadow.Name = "Shadow"
	Shadow.Parent = MainFrame
	Shadow.AnchorPoint = Vector2.new(0.5, 0.5)
	Shadow.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Shadow.BackgroundTransparency = 1.000
	Shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
	Shadow.Size = UDim2.new(1, 40, 1, 40)
	Shadow.ZIndex = 0
	Shadow.Image = "rbxassetid://6015897843"
	Shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
	Shadow.ImageTransparency = 0.5
	Shadow.SliceCenter = Rect.new(49, 49, 450, 450)
	Shadow.ScaleType = Enum.ScaleType.Slice

	-- Top Bar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Parent = MainFrame
	TopBar.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
	TopBar.BorderSizePixel = 0
	TopBar.Size = UDim2.new(1, 0, 0, 40)

	local TopBarCorner = Instance.new("UICorner")
	TopBarCorner.CornerRadius = UDim.new(0, 10)
	TopBarCorner.Parent = TopBar
	
	local FixPatch = Instance.new("Frame")
	FixPatch.BorderSizePixel = 0
	FixPatch.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
	FixPatch.Size = UDim2.new(1, 0, 0, 10)
	FixPatch.Position = UDim2.new(0, 0, 1, -10)
	FixPatch.Parent = TopBar

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Parent = TopBar
	TitleLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	TitleLabel.BackgroundTransparency = 1.000
	TitleLabel.Position = UDim2.new(0, 15, 0, 0)
	TitleLabel.Size = UDim2.new(0, 200, 1, 0)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	TitleLabel.TextSize = 16.000
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local Gradient = Instance.new("UIGradient")
    Gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(150, 100, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 200, 255))
    }
    Gradient.Parent = TitleLabel

	-- Close Button (Actually Hide)
	local CloseBtn = Instance.new("TextButton")
	CloseBtn.Parent = TopBar
	CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	CloseBtn.BackgroundTransparency = 1.000
	CloseBtn.Position = UDim2.new(1, -35, 0, 5)
	CloseBtn.Size = UDim2.new(0, 30, 0, 30)
	CloseBtn.Font = Enum.Font.GothamBold
	CloseBtn.Text = "-"
	CloseBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
	CloseBtn.TextSize = 20.000
	CloseBtn.MouseButton1Click:Connect(function() 
		MainFrame.Visible = false 
	end)
	
	-- Toggle Logic
	local UI_Open = true
	ToggleBtn.MouseButton1Click:Connect(function()
		UI_Open = not UI_Open
		MainFrame.Visible = UI_Open
	end)
	
	-- Fixed Draggable Logic
	local Dragging, DragInput, DragStart, StartPosition
	
	TopBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			Dragging = true
			DragStart = input.Position
			StartPosition = MainFrame.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					Dragging = false
				end
			end)
		end
	end)

	TopBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			DragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == DragInput and Dragging then
			local delta = input.Position - DragStart
			MainFrame.Position = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + delta.Y)
		end
	end)
	
	-- Global Input Ended Fix
	UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			Dragging = false
		end
	end)

	-- Container
	local Container = Instance.new("ScrollingFrame")
	Container.Name = "Container"
	Container.Parent = MainFrame
	Container.Active = true
	Container.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Container.BackgroundTransparency = 1.000
	Container.BorderSizePixel = 0
	Container.Position = UDim2.new(0, 10, 0, 50)
	Container.Size = UDim2.new(1, -20, 1, -60)
	Container.ScrollBarThickness = 2
	Container.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 255)

	local UIListLayout = Instance.new("UIListLayout")
	UIListLayout.Parent = Container
	UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
	UIListLayout.Padding = UDim.new(0, 8)

	local WindowFunctions = {}

	function WindowFunctions:AddButton(Text, Callback)
		local ButtonFrame = Instance.new("Frame")
		ButtonFrame.Parent = Container
		ButtonFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
		ButtonFrame.Size = UDim2.new(1, 0, 0, 40)
		Instance.new("UICorner", ButtonFrame).CornerRadius = UDim.new(0, 6)

		local Btn = Instance.new("TextButton")
		Btn.Parent = ButtonFrame
		Btn.BackgroundTransparency = 1
		Btn.Size = UDim2.new(1,0,1,0)
		Btn.Font = Enum.Font.GothamSemibold
		Btn.Text = Text
		Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
		Btn.TextSize = 14
		
		Btn.MouseEnter:Connect(function() TweenService:Create(ButtonFrame, TweenInfo.new(0.2), {BackgroundColor3=Color3.fromRGB(45,45,50)}):Play() end)
		Btn.MouseLeave:Connect(function() TweenService:Create(ButtonFrame, TweenInfo.new(0.2), {BackgroundColor3=Color3.fromRGB(35,35,40)}):Play() end)
		Btn.MouseButton1Click:Connect(function() if Callback then Callback() end end)
	end
	
	function WindowFunctions:AddToggle(Text, Callback)
		local Toggled = false
		local ToggleFrame = Instance.new("Frame")
		ToggleFrame.Parent = Container
		ToggleFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
		ToggleFrame.Size = UDim2.new(1,0,0,40)
		Instance.new("UICorner", ToggleFrame).CornerRadius = UDim.new(0, 6)

		local Label = Instance.new("TextLabel")
		Label.Parent = ToggleFrame
		Label.BackgroundTransparency = 1
		Label.Position = UDim2.new(0,15,0,0)
		Label.Size = UDim2.new(0,200,1,0)
		Label.Font = Enum.Font.GothamSemibold
		Label.Text = Text
		Label.TextColor3 = Color3.fromRGB(255,255,255)
		Label.TextSize = 14
		Label.TextXAlignment = Enum.TextXAlignment.Left

		local ToggleBtn = Instance.new("TextButton")
		ToggleBtn.Parent = ToggleFrame
		ToggleBtn.BackgroundTransparency = 1
		ToggleBtn.Size = UDim2.new(1,0,1,0)
		ToggleBtn.Text = ""

		local Switch = Instance.new("Frame")
		Switch.Parent = ToggleFrame
		Switch.BackgroundColor3 = Color3.fromRGB(60,60,65)
		Switch.Position = UDim2.new(1,-55,0.5,-10)
		Switch.Size = UDim2.new(0,40,0,20)
		Instance.new("UICorner", Switch).CornerRadius = UDim.new(1,0)

		local Circle = Instance.new("Frame")
		Circle.Parent = Switch
		Circle.BackgroundColor3 = Color3.fromRGB(255,255,255)
		Circle.Position = UDim2.new(0,2,0.5,-8)
		Circle.Size = UDim2.new(0,16,0,16)
		Instance.new("UICorner", Circle).CornerRadius = UDim.new(1,0)

		ToggleBtn.MouseButton1Click:Connect(function()
			Toggled = not Toggled
			local TargetColor = Toggled and Color3.fromRGB(100,200,255) or Color3.fromRGB(60,60,65)
			local TargetPos = Toggled and UDim2.new(1,-18,0.5,-8) or UDim2.new(0,2,0.5,-8)
			TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3=TargetColor}):Play()
			TweenService:Create(Circle, TweenInfo.new(0.2), {Position=TargetPos}):Play()
			if Callback then Callback(Toggled) end
		end)
	end

	function WindowFunctions:AddBox(Text, Callback)
		local BoxFrame = Instance.new("Frame")
		BoxFrame.Parent = Container
		BoxFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
		BoxFrame.Size = UDim2.new(1,0,0,40)
		Instance.new("UICorner", BoxFrame).CornerRadius = UDim.new(0, 6)

		local Label = Instance.new("TextLabel")
		Label.Parent = BoxFrame
		Label.BackgroundTransparency = 1
		Label.Position = UDim2.new(0,15,0,0)
		Label.Size = UDim2.new(0,150,1,0)
		Label.Font = Enum.Font.GothamSemibold
		Label.Text = Text
		Label.TextColor3 = Color3.fromRGB(255,255,255)
		Label.TextSize = 14
		Label.TextXAlignment = Enum.TextXAlignment.Left

		local TextBox = Instance.new("TextBox")
		TextBox.Parent = BoxFrame
		TextBox.BackgroundColor3 = Color3.fromRGB(25,25,30)
		TextBox.Position = UDim2.new(1,-110,0.5,-12)
		TextBox.Size = UDim2.new(0,100,0,24)
		TextBox.Font = Enum.Font.Gotham
		TextBox.PlaceholderText = "#"
		TextBox.Text = ""
		TextBox.TextColor3 = Color3.fromRGB(255,255,255)
		TextBox.TextSize = 13
		Instance.new("UICorner", TextBox).CornerRadius = UDim.new(0, 4)

		TextBox.FocusLost:Connect(function(enter)
			if Callback then Callback(TextBox, enter) end
		end)
	end
	
	function WindowFunctions:AddLabel(Text)
		local LabelFrame = Instance.new("Frame")
		LabelFrame.Parent = Container
		LabelFrame.BackgroundTransparency = 1
		LabelFrame.Size = UDim2.new(1,0,0,25)
		
		local Label = Instance.new("TextLabel")
		Label.Parent = LabelFrame
		Label.BackgroundTransparency = 1
		Label.Size = UDim2.new(1,0,1,0)
		Label.Font = Enum.Font.GothamBold
		Label.Text = Text
		Label.TextColor3 = Color3.fromRGB(150,150,150)
		Label.TextSize = 12
	end

	return WindowFunctions
end
-- [END UI LIBRARY] --

-- Cấu hình mặc định
local Config = {
	Speed = 350,
	TweenTime = 0,
	AutoFarm = false,
	AutoDeliver = false,
	FPSBoost = true,
	WhiteScreen = false,
}

local State = {
	Car = nil,
	GroundPart = nil,
	BackupFolder = nil,
	CurrentTween = nil
}

-- [FPS BOOST SYSTEM]
local function SuperFPSBoost()
	settings().Rendering.QualityLevel = 1
	settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Level01
	Lighting.GlobalShadows = false
	Lighting.FogEnd = 9e9
	Lighting.Brightness = 0
	
	for _, v in pairs(Lighting:GetChildren()) do
		if v:IsA("PostEffect") or v:IsA("Atmosphere") or v:IsA("Sky") then v:Destroy() end
	end
	
	local function clearVisuals()
		for _, v in pairs(Workspace:GetDescendants()) do
			if v:IsA("Decal") or v:IsA("Texture") or v:IsA("ParticleEmitter") or v:IsA("Trail") then
				v:Destroy()
			elseif v:IsA("MeshPart") then
				v.RenderFidelity = Enum.RenderFidelity.Precise
				v.Material = Enum.Material.Plastic
				v.Reflectance = 0
			end
		end
	end
	clearVisuals()
	
	if Config.WhiteScreen then RunService:Set3dRenderingEnabled(false) end
end

-- [ANTI AFK]
if not getgenv().AntiAfkLoaded then
	getgenv().AntiAfkLoaded = true
	local vu = game:GetService("VirtualUser")
	LocalPlayer.Idled:Connect(function()
		vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
		task.wait(1)
		vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
	end)
end

-- [LOGIC FARM]
local function createGround()
	if not State.GroundPart or not State.GroundPart.Parent then
		local p = Instance.new("Part")
		p.Name = "Speedway"
		p.Size = Vector3.new(100000, 5, 100000)
		p.Anchored = true
		p.Transparency = 1 
		p.CanCollide = true
		p.Position = Vector3.new(0, -400, 0)
		p.Parent = Workspace
		State.GroundPart = p
	end
end

local function GetCar()
	local char = LocalPlayer.Character
	if not char then return nil end
	local hum = char:FindFirstChild("Humanoid")
	if not hum or not hum.SeatPart then return nil end
	return hum.SeatPart.Parent
end

local function TweenTo(targetPos, speedOverride)
	local car = GetCar()
	if not car or not car.PrimaryPart then return end
	local root = car.Body:FindFirstChild("#Weight") or car.PrimaryPart
	car.PrimaryPart = root
	
	createGround()
	local targetCFrame = (typeof(targetPos) == "CFrame") and targetPos or CFrame.new(targetPos)
	local speed = speedOverride or Config.Speed
	local dist = (root.Position - targetCFrame.Position).Magnitude
	local time = dist / speed
	
	local cframeValue = Instance.new("CFrameValue")
	cframeValue.Value = root.CFrame
	
	local connection
	connection = cframeValue.Changed:Connect(function(val)
		if not car or not car.Parent then connection:Disconnect() return end
		State.GroundPart.Position = Vector3.new(val.X, val.Y - 10, val.Z)
		car:PivotTo(val)
		root.AssemblyLinearVelocity = Vector3.zero 
	end)
	
	local tween = TweenService:Create(cframeValue, TweenInfo.new(time, Enum.EasingStyle.Linear), {Value = targetCFrame})
	State.CurrentTween = tween
	tween:Play()
	tween.Completed:Wait()
	
	if connection then connection:Disconnect() end
	cframeValue:Destroy()
end

State.BackupFolder = ReplicatedStorage:FindFirstChild("LagReduction") or Instance.new("Folder", ReplicatedStorage)
State.BackupFolder.Name = "LagReduction"

local function ClearMap()
	for _, v in pairs(Workspace:GetChildren()) do
		if v:IsA("Model") and v ~= LocalPlayer.Character and v ~= State.Car and v.Name ~= "Speedway" and not v:FindFirstChild("Highlight") and v.Name ~= "GiftPickup" then
			v.Parent = State.BackupFolder
		end
	end
end

local function RestoreMap()
	for _, v in pairs(State.BackupFolder:GetChildren()) do v.Parent = Workspace end
end

-- [INITIALIZE UI]
local Window = Library:CreateWindow({text = "Midnight Farm SUPER FAST"})

Window:AddToggle("Auto Farm (Quest)", function(state)
	Config.AutoFarm = state
	if state then
		ClearMap()
		createGround()
		task.spawn(function()
			while Config.AutoFarm do
				if GetCar() then
					local points = {
						Vector3.new(105, -26, 7965), Vector3.new(2751, -26, 3694),
						Vector3.new(-6408, -26, -727), Vector3.new(-8821, -26, 2042),
						Vector3.new(4887, -26, 1222)
					}
					for _, p in ipairs(points) do
						if not Config.AutoFarm then break end
						TweenTo(p + Vector3.new(0, 10, 0))
					end
				end
				task.wait(1)
			end
		end)
	else
		if State.CurrentTween then State.CurrentTween:Cancel() end
		RestoreMap()
	end
end)

Window:AddToggle("Auto Deliver (Event)", function(state)
	Config.AutoDeliver = state
	if state then
		ClearMap()
		createGround()
		task.spawn(function()
			while Config.AutoDeliver do
				local car = GetCar()
				if car then
					local target, minDist = nil, math.huge
					for _, v in pairs(Workspace:GetChildren()) do
						if v.Name == "" and v:FindFirstChild("Highlight") then
							local d = (car.PrimaryPart.Position - v.WorldPivot.Position).Magnitude
							if d < minDist then minDist = d; target = v end
						end
					end
					
					if target then
						TweenTo(target.WorldPivot.Position + Vector3.new(0, 5, 0))
					elseif Workspace:FindFirstChild("GiftPickup") then
						TweenTo(Workspace.GiftPickup.WorldPivot.Position + Vector3.new(0, 5, 0))
						task.wait(1.5)
					end
				end
				task.wait()
			end
		end)
	else
		if State.CurrentTween then State.CurrentTween:Cancel() end
		RestoreMap()
	end
end)

Window:AddLabel("--- SETTINGS ---")
Window:AddBox("Speed (Max: 400)", function(obj) Config.Speed = tonumber(obj.Text) or 350 end)
Window:AddButton("Activate FPS BOOST", function() SuperFPSBoost() end)
Window:AddToggle("White Screen (Save GPU)", function(state)
	Config.WhiteScreen = state
	RunService:Set3dRenderingEnabled(not state)
end)

warn("Loaded Extreme Speed Script with Modern UI v2")